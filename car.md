## 购物车案例模块-基于jQuery

[toc]

2023年5月25日23点57分

### 全选分析模块

1. 全选思路：里面3个li的复选按钮（`j-checkbox`）选中状态（`checked`）跟着全选按钮（`checkall`）走
2. `checked`是复选框的固有属性，可以使用 `prop()`方法获取和设置该属性
3. 把全选按钮状态赋值给3个小复选框即可。
4. 每当点击小复选框按钮，就判断：
5. 若小复选框被选中个数等于3（全部商品数）就应该把全选按钮选上，否则全选按钮不勾选
6. `:checked`选择器，查找被选中的表单元素。

### 增减商品模块

1. 核心思路：首先声明一个变量，当点击 `+`号（`increment`），就让这个值自增一（`++`），然后赋值给文本框。
2. **注意1**：只能增加本商品的数量，即当前 `+`号的兄弟节点文本框（`itxt`）的值。
3. 修改表单的值方法为val()
4. **注意2**：这个变量初始值应该是这个文本框的值，在这个值的基础上自增。要获取表单的值
5. 减号（`decrement`）思路同理，**但是若文本框的值是1，就不能再减了**

### 修改商品小计模块

1. 核心思路：每次点击 `+`号或 `-`号，根据文本框的值乘以当前商品的单价即商品小计
2. **注意1**：只能增加本商品的小计，即当前商品的小计模块（`p-sum`）
3. 修改普通元素的内容是 `text()`方法
4. **注意2**：当前商品的价格，要把 `￥`符号去掉再相乘，截取字符串 `substr(1)`从字符串的第二个字符（索引为1）开始提取子字符串
5. parents('选择器')可以返回指定父级元素
6. 最后计算的结果若想要保留两位小数，通过 `toFixed(2)`方法
7. 用户也可以直接修改表单里面的值，同样要计算小计。用表单 `change`事件
8. 用最新的表单内的值乘以单价即可，但是还是当前商品小计

### 计算总计和总额

1. 核心思路：把所有文本框里面的值相加就是总计数量。总额同理
2. 文本框里面的值不相同，若想要相加需要用到each遍历。声明一个变量，相加即可
3. 点击+-号，会改变总计和总额，若用户修改了文本框里面的值同样会改变总计和总额
4. 因此可以封装一个函数，以上2个操作调用此函数即可
5. **注意1**：总计是文本框里面的值相加用val()，总额是普通元素的内容用text()
6. 普通元素里面的内容要去掉 `￥`并且转换为数字型数据才能相加

### 删除商品模块

1. 核心思路：把商品remove()删除元素即可
2. 有三个地方需要删除：1.商品后面的删除按钮；2.删除选中的商品；3.清理购物车
3. 商品后面的删除按钮：一定是删除当前的商品，所以从$(this)出发

### 选定商品添加背景

1. 核心思路：选中的商品添加背景，不选中移除背景即可
2. 全选按钮点击：若全选被选中，则所有商品添加背景，否则移除
3. 小复选框点击：若是选中状态，则当前商品添加背景，否则移除
4. 背景可以通过类名修改，添加类和删除类

---

## bug

### 页面加载选中商品背景色修改

`what`：页面加载时已选中的商品未赋予背景色

`why`：添加的判断选中语句写在change事件中，页面加载未触发事件

`how`：判断语句单独封装成函数checkItem(ele)，ele为传入的复选框元素

### 删除商品后全选失灵

`what`：三个商品删除其一后，选中剩下两个，全选按钮未选中

`why`：小复选框判断选中个数与总商品数是否相同时，总商品数被写死为3导致判断不准

`how`：外部定义变量jlength存放总商品数，替换3，且定义函数updateGoodsNum()更新商品数量

### 删除未选中商品，全选失灵

`what`：三个商品删除其中2个未选中的商品，全选按钮未选中

`why`：对商品数量与选中数量判断的语句只写在单个商品复选框的change事件中，在删除按钮点击事件中未使用

`how`：提取函数ifCheckAll()，用于商品数量与选中数量判断并修改全选框状态
